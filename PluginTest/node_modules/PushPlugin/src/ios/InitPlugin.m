//
//  InitPlugin.m
//  PluginTest
//
//  Created by wangxianjin on 2017/9/14.
//
//

#import "InitPlugin.h"
#import <CloudPushSDK/CloudPushSDK.h>

@implementation InitPlugin

-(void)init:(CDVInvokedUrlCommand *)cmd{
    [self initPush];
}

-(void)initPush{
    NSMutableDictionary *plistDict=[[NSMutableDictionary alloc]initWithContentsOfFile:@"plist"];
    NSString *app_key=[plistDict valueForKey:@"AppKey"];
    NSString *app_secret=[plistDict valueForKey:@"AppSecret"];
    [CloudPushSDK asyncInit:app_key appSecret:app_secret callback:^(CloudPushCallbackResult *res) {
        if (res.success) {
            NSLog(@"success");
            [self registerAPNS:[UIApplication sharedApplication]];
        }else{
            NSLog(@"%@",res.error);
        }
    }];

}

- (void)registerAPNS:(UIApplication *)application {
    if ([[[UIDevice currentDevice] systemVersion] floatValue] >= 8.0) {
        // iOS 8 Notifications
        [application registerUserNotificationSettings:
         [UIUserNotificationSettings settingsForTypes:
          (UIUserNotificationTypeSound | UIUserNotificationTypeAlert | UIUserNotificationTypeBadge)
                                           categories:nil]];
        [application registerForRemoteNotifications];
    }
    else {
        // iOS < 8 Notifications
        [[UIApplication sharedApplication] registerForRemoteNotificationTypes:
         (UIRemoteNotificationTypeAlert | UIRemoteNotificationTypeBadge | UIRemoteNotificationTypeSound)];
    }
}


@end
